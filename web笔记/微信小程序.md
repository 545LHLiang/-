# 小程序

## 与网页区别

- 运行环境不同：网页：浏览器   小程序：微信环境
- api不同：小程序无法调用dom和bom  有独立的api
- 开发模式不同： 网页：浏览器+代码编辑器  小程序：自己标准的开发模式

## 注册账号

- 微信小程序官网进行注册 选择小程序
- 获取小程序：appid   登录之后 点击左侧开发  开发设置就可以看到 

## 小程序基本组成结构

-  ==pages  存放页面==
- utils  工具性质模块
- ==app.js 入口文件==
- ==app.js 全局配置文件==
- app.wxss 全局样式文件
- project.config.json 项目配置文件
- sitemap.js 用来配置小程序及其他页面是否被微信索引

## 小程序页面组成部分

- index ：js业务逻辑  json配置文件 wxml 页面 wxml 样式

### json

- 4种配置文件
- app.json 
  - ==pages 所有页面路径==
  - ==window  定义所有页面的背景色和文字颜色==
  - ==style： 样式版本号==
  - sitemapLocation   指明sitemap的位置
-  project.config.json   个性化配置
  - setting  编译相关配置  本地配置复选框链接
    - checkSiteMap 改为false  关闭黄色警告
  - appid   小程序账号id   用被人的项目时， 将它改为自己的id 
  - projectname 项目名称  与小程序名称 不一样
-  sitemap.json  小程序内搜索  微信索引  
  - action: allow  被索引   disallow  不被索引
-  每个文件夹的.json  覆盖window中相同的配置项  页面配置项会覆盖全局的配置项

## 新建小程序页面

-  app.json  中的pages "那个文件/文件夹名/文件名"  路径
- 修改项目首页  将 pages中的  路径提前   
- wxml：相当于html  
  - 区别： 标签名称不同   div>view  span>text  img>image  a >navigator
  - 属性节点不同 ： href>url
  - 提供了模板语法 数据绑定  列表渲染 条件渲染
- wxss ：相当于css
  - 新增rpx 尺寸  自适应大小
  - 全局样式和局部样式
  - 仅支持部分css选择器   类 id 元素 并集 后代  伪类

## js文件

- app.js 入口文件
- 页面.js   页面入口文件  通过 Page()函数来创建并运行页面
- 普通.js   封装函数 功能模块文件

## 宿主环境

- 程序运行必须的依赖环境  手机微信

-  通信模型

  - 渲染层 wxml wxss
  - 逻辑层   js

- ![](D:\web笔记\笔记\web笔记\wx1.png)

- 运行机制

  -  启动
    - 下载代码包   解析app.json 执行app.js 嗲用app  渲染  启动完成
  - 渲染
    - 解析json  加载 wxml wxss   执行 js  完成渲染

- 组件

  - 视图容器

    - view 

      - 普通识图区域  相当于div

      - 使用 同div

      -  justify-content: space-around;    主轴 分散布局

      - ```js
        <view class="container">
         <view>A</view>
         <view>B</view>
         <view>C</view>
        </view>
        ```

        ​

    - sroll-view

      - 可滚动的识图区域   

      - 使用 添加  属性 scroll-y/x 滚动方式   添加 限定的宽高 

      - ```js
        <scroll-view class="container1" scroll-y>
         <view>A</view>
         <view>B</view>
         <view>C</view>
        </scroll-view >
        ```

    -  swiper和 swiper-item

      - 轮播图 和 轮播图项
      - 使用: 小圆点 indicator-dots   是否显示

    - -color 未选中颜色  active-color 选中颜色  

      - autoplay  自动切换 布尔值  interval 切换时间间隔    毫秒  circular 布尔  衔接滑动


```js
   <swiper class="container" indicator-dots="true">
    <swiper-item>
      <view>A</view>
    </swiper-item>
    <swiper-item>
      <view>B</view>
    </swiper-item><swiper-item>
      <view>C</view>
    </swiper-item>
    </swiper>
```

  - 基础内容

    - text文本  类似 span  ==只有text 组件 可以 长按选中内容==
      - 旧  selectable 已废弃  新user-select="true" 
    -   rich-text  富文本
      - nodes  把html代码渲染对应的UI结构

  - button  同element- ui

    - 按钮组件
    - 功能比html丰富
    - 通过 open-type 属性 调用微信提供的各种功能
    - type  primary 主色调  warn 警告  
    - size 尺寸大小  mini
    - plain 镂空按钮

  - image

    - src 路径  / 根目录 
    - mode 属性
      - scaleToFill  不保持纵横比   默认填满
      - aspectFit 保持纵横比  完整填满的显示出来
      - aspectFill   保持纵横比    水平或垂直 完整
      - widthFix    宽度不变   高度自适应
      - heigthFix   高度不变  宽度自适应

  - 表单

  - 导航

  - 媒体  map  canvas 画布  开放内力  无障碍访问

- API

  - 事件监听   以on开头 
    - wx.onWindowResize(回调函数 ) 监听尺寸变化事件
  - 同步API   以Sync  结尾   可通过函数返回值直接获取  错误则抛出异常
    - wx.setStorageSync('key','value') 本地存储内容
  - 异步API   通过 success 和fail complete 接受回调结果
    - wx.request() 发起网络请求， 通过success 回调接收数据 

## 模版与配置

## wxml模版语法

### 数据绑定

- 定义:  在对应的.js文件中的   date 中定义数据  同vue
- 使用：{{}} 同vue  插值表达式
- ==属性和内容 都是 {{}}语法==

### 事件绑定

- 常用事件：tap手指触摸后马上离开事件(同click)  input事件(文本框输入)  change事件(状态改变事件)
- 绑定事件：bind 或 ：  bindtap  ：tap    常用bind
- event属性：  type 事件类型  target  触发事件的组件属性  detail 额外信息
  - ![](D:\web笔记\笔记\web笔记\event.png)
  - 练习
  - ![](D:\web笔记\笔记\web笔记\event1.png)

### 为data中的数据赋值

- this.setData({ data中的数据：xxx  })
- this.data.数据  访问data中的数据  this指向 page

### 事件传参

- 传： data-xxx="{{3]}}"  取：e.target.dataset.参数名
- e.detail.value 获取文本框的值
- 文本框内容与数据同步    动态绑定数据  通过inpt事件 数据值改为文本框内容  

```js
 <button bindtap='add' data-num="{{2}}">{{sum}}</button>
  add(e){
    this.setData({
      sum:this.data.sum +e.target.dataset.num
    })
  }
```

### 条件渲染

- wx:if="{{xxxx}}"
- 结合block容器一次性控制多个组件的展示和隐藏
- hidden="{{xxxx}}"   同v-show  无法 在block使用

### 列表渲染

- \<view wx:for="{{数组}}"  wx:key="id"> 索引  index  当前下 item

## wxss模板样式

![](D:\web笔记\笔记\web笔记\wxcc.png)

### rpx  1px=2rpx

### 样式导入

- @import  "相对路径"  ；结束
- 全局样式  在app.wxss  中
- 局部样式   每个文件对应的.wxss
  - 全局和局部 冲突时   就近原则  局部 替换掉全局    局部权重大于或等于 才会覆盖

## 全局配置

- pages 存放页面路径 和新建文件
- window  全局设置小程序窗口的外观
  - ![](D:\web笔记\笔记\web笔记\windows.png)
  - navigationBar  导航栏
    - navigationBarTitleText 导航栏标题
    - navigationBarBackgroundColor  背景色
    - navigationBarTextStyle    字体颜色
  - background    背景  下来刷新背景
    - backgroundColor   只能16进制的颜色值
    - backgroundTextStyle   loading样式 指定dark/light 值
  - enablePullDownRefresh  全局开启 下来 刷新 默认 false
  - onReachBottomDistance  上拉触底事件触发时距离页面底部距离 默认 50px    px 可以省略
- tabBar  底部的导航栏
- ![](D:\web笔记\笔记\web笔记\tabbar.png)
  - 实现多个页面的快速切换
  - 最少2个 最多5个
  - 顶部只能显示文本
  - 底部可以设置icon图标
  - 背景色  选中时的图片路径   上边框颜色   未选中的图片路径   
  - 选中时文字颜色  未选中
  - 节点配置项
  - ![](D:\web笔记\笔记\web笔记\tabar 配置项.png)
  - tab配置项
  - ![](D:\web笔记\笔记\web笔记\tab.png)
- style  是否启用新版的组件样式   v2 启用
- ![](D:\web笔记\笔记\web笔记\tabbar list.png)

## 网络数据请求

- 只能请求https类型接口
- 必须将接口的域名添加到信任列表
- ![](D:\web笔记\笔记\web笔记\信任列表.png)

### 配置request合法的域名

-  微信小程序官网 开发 中 服务器 域名
- 域名只支持https协议  必须经过ICP备案   一个月最多5次

### 发送get请求

- wx.request() 

  ```js
  wx.request({
      url:'请求接口地址',
      method：'GET/post',
      data:{},
      success:(res)=>{} //成功回调
  })
  ```

- 在页面刚加载时调用的数据或发请求  使用onLoad事件  在函数前添加

  - onLoad：function(){}

### 跳过request合法的域名

- 本地设置   不校验合法域名    小程序没有跨域问题

## 页面导航

- 声明式导航   \<navigator>      
  -  url  页面地址   必须/开头
  -  open-type  跳转方式：必须switchTab
  - 跳转非TabBar 页面   switchTab 改为navigator(可以省略)
  - 后退导航   属性 为  open-type值：navigateBack  delta  数字  后退层数 默认为1  为1是 delta可以省略
- 编程式导航 
  - wx.switchTab(object/{}) object参数如下：  为对象格式
    - url：页面路径  必选
    - success 成功回调
    - fail  失败回调
    - complete 成功/失败都执行
  - 非tabbar 页面   wx.navigateTo  参数同上
  - 后退 wx.navigateBack  delta 1省略

### 传、收参

- 声明式：  参数与路径 ？  参数键与值 =   多个参数&

- onload生命周期函数  中可以接受到参数

- ```js
  data{
      query：{}
  }
  onLoad:function(option){
      this.setData({
          query:option
      })
  }
  ```

## 页面事件

### 下拉刷新事件

- 全局 不推荐
  -  .json 的 window节点  将enblePullDownRefresh true	
- 局部  推荐
  -  .json 的 window节点  将enblePullDownRefresh true
- 样式：
  - backgroundColor 窗口背景颜色
  - backgroundTextStyle loading样式  仅支持 dark和light  
- 下来刷新事件监听函数
  -  onPullDownRefresh：function(){}  
- 停止下拉刷新 
  - 在监听函数中最后 wx.stopPullDownRefresh()

### 上拉触底

- onReachBottom函数  默认生成的
- 在页面或者 全局 .json  onReachBottomDistance 配置触底距离 

## 生命周期

-  自动安次序执行
- 生命后期是时间段  生命周期函数是时间点 

### 应用生命周期函数

- 在app.js中声明  使用 直接调用APP()函数
- onLaunch 初始化完成时，全局只触发一次
- onShow  小程序启动  或 从后台进入前台显示时触发  手机前后台
- onHide   从前台进入后台时触发

### 页面生命周期函数、

- page方法  自动生成以下
- onLoad  监听页面加载  只调用一次
- onShow  页面显示
- onReady  页面初次渲染   只调用一次、
  - 可以修改标题
- onHide    页面隐藏
- onUnload   页面卸载  只调用一次 